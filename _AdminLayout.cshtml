<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>MONCO MDC - @Page.Title</title>
        <link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon" />
        
        <!-- Core CSS - Include with every page -->
        <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" /> <!-- Bootstrap CSS -->
        <!--<link href="http://bootswatch.com/lumen/bootstrap.min.css" rel="stylesheet" /> <!-- Bootstrap Customer theme -->

        <!-- Easy ways to get Font Awesome 4.0.3 onto your website - CDN -->
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

        <!-- Page-Level Plugin CSS - Dashboard -->
        <link href="~/Content/animate.css" rel="stylesheet" />
        
        <!-- Page-Level Plugin CSS - Tables -->
        <link href="~/Content/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet" />

        <!-- Custom styles for this theme -->
        <link rel="stylesheet" href="~/Content/spacelab.css">

        <!-- jQuery Core Scripts - Include with every page -->
        <script src="~/Scripts/jquery-2.1.0.min.js"></script>

        <script src="~/Scripts/modernizr-2.7.2.js"></script>
        <script src="~/Scripts/jquery.validate.min.js"></script>
        <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>

        <!-- Bootstrap Javajscript - CDN -->
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script> 

        <!-- Page-Level Plugin Scripts - Tables -->
        <script src="~/Scripts/DataTables-1.9.4/media/js/jquery.dataTables.js"></script>
        <script src="~/Scripts/plugins/dataTables/dataTables.bootstrap.js"></script>

        <!-- Core Scripts - Include wit every page -->
        <script src="~/Scripts/jquery.countTo.js"></script>
        <script src="~/Scripts/application.js"></script>
        <script src="~/Scripts/monco.admin.js"></script>

        @RenderSection("Scripts", required: false)

    </head>
    <body class="tooltips">
        <section id="container">
        
        <header id="header">
            <!--logo start-->
            <div class="brand">
                <a href="~/Admin/Admin" class="logo"><span>Monco</span>MDC</a>
            </div>
            <!--logo end-->
            <div class="toggle-navigation toggle-left">
                <button type="button" class="btn btn-default" id="toggle-left" data-toggle="tooltip" data-placement="right" title="" data-original-title="Toggle Navigation">
                    <i class="fa fa-bars"></i>
                </button>
            </div>
            <div class="user-nav">
                <ul>
                    <!--
                    <li class="dropdown messages">
                        <span class="badge badge-danager animated bounceIn" id="new-messages">5</span>
                        <button type="button" class="btn btn-default dropdown-toggle options" id="toggle-mail" data-toggle="dropdown">
                            <i class="fa fa-envelope"></i>
                        </button>
                        <ul class="dropdown-menu alert animated fadeInDown">
                            <li>
                                <h1>You have <strong>5</strong> new messages</h1>
                            </li>
                            <li>
                                <a href="http://authenticgoods.co/wrapbootstrap/themes/spacelab/index.html#">
                                    <div class="profile-photo">
                                        <img src="~/Uploaded/SpaceLab_files/avatar.gif" alt="" class="img-circle">
                                    </div>
                                    <div class="message-info">
                                        <span class="sender">James Bagian</span>
                                        <span class="time">30 mins</span>
                                        <div class="message-content">Lorem ipsum dolor sit amet, elit rutrum felis sed erat augue fusce...</div>
                                    </div>
                                </a>
                            </li>

                            <li>
                                <a href="http://authenticgoods.co/wrapbootstrap/themes/spacelab/index.html#">
                                    <div class="profile-photo">
                                        <img src="~/Uploaded/SpaceLab_files/avatar1.gif" alt="" class="img-circle">
                                    </div>
                                    <div class="message-info">
                                        <span class="sender">Jeffrey Ashby</span>
                                        <span class="time">2 hour</span>
                                        <div class="message-content">hendrerit pellentesque, iure tincidunt, faucibus vitae dolor aliquam...</div>
                                    </div>
                                </a>
                            </li>

                            <li>
                                <a href="http://authenticgoods.co/wrapbootstrap/themes/spacelab/index.html#">
                                    <div class="profile-photo">
                                        <img src="~/Uploaded/SpaceLab_files/avatar2.gif" alt="" class="img-circle">
                                    </div>
                                    <div class="message-info">
                                        <span class="sender">John Douey</span>
                                        <span class="time">3 hours</span>
                                        <div class="message-content">Penatibus suspendisse sit pellentesque eu accumsan condimentum nec...</div>
                                    </div>
                                </a>
                            </li>

                            <li>
                                <a href="http://authenticgoods.co/wrapbootstrap/themes/spacelab/index.html#">
                                    <div class="profile-photo">
                                        <img src="~/Uploaded/SpaceLab_files/avatar3.gif" alt="" class="img-circle">
                                    </div>
                                    <div class="message-info">
                                        <span class="sender">Ellen Baker</span>
                                        <span class="time">7 hours</span>
                                        <div class="message-content">Sem dapibus in, orci bibendum faucibus tellus, justo arcu...</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="http://authenticgoods.co/wrapbootstrap/themes/spacelab/index.html#">
                                    <div class="profile-photo">
                                        <img src="~/Uploaded/SpaceLab_files/avatar4.gif" alt="" class="img-circle">
                                    </div>
                                    <div class="message-info">
                                        <span class="sender">Ivan Bella</span>
                                        <span class="time">6 hours</span>
                                        <div class="message-content">Curabitur metus faucibus sapien elit, ante molestie sapien...</div>
                                    </div>
                                </a>
                            </li>
                            <li><a href="http://authenticgoods.co/wrapbootstrap/themes/spacelab/index.html#">Check all messages <i class="fa fa-angle-right"></i></a>
                            </li>
                        </ul>

                    </li>
                    -->
                    <li class="profile-photo">
                        <img src="~/Uploaded/SpaceLab_files/man-icon.png" alt="" class="img-circle">
                    </li>
                    <li class="dropdown settings">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        @WebSecurity.CurrentUserName <i class="fa fa-angle-down"></i>
                        </a>
                        <ul class="dropdown-menu animated fadeInDown">
                            <li>
                                <a href="~/">
                                    <i class="fa fa-chevron-circle-left fa-fw"></i> User's Page
                                </a>
                            </li>
                            <li>
                                <a href="~/Account/Manage">
                                    <i class="fa fa-user fa-fw"></i> Profile
                                </a>
                            </li>
                            <li>
                                <form id="logoutForm" action="~/Account/Logout" method="post">
                                @AntiForgery.GetHtml()
                                </form>
                                <a href="javascript:document.getElementById('logoutForm').submit()">
                                    <i class="fa fa-power-off fa-fw"></i> Log off
                                </a>
                            </li>
                        </ul>
                    </li>
                    
                    <li>
                        <div class="toggle-navigation toggle-right">
                            <button type="button" class="btn btn-danger" id="toggle-right">
                                <i class="fa fa-lemon-o animated swing"></i>
                            </button>
                        </div>
                    </li>
                    
                </ul>
            </div>
        </header>

        <!--sidebar left start-->
        <aside class="sidebar">
            <div id="leftside-navigation" class="nano">
                <ul class="nano-content">
                    <li>
                        <a href="~/Admin/Admin"><i class="fa fa-dashboard fa-lg fa-fw"></i><span>Dashboard</span></a>
                    </li>
                    <li>
                       <a href="~/Admin/UserManagement"><i class="fa fa-users fa-lg fa-fw"></i><span>Manage Account</span></a>
                    </li>
                    <li>
                        <a href="~/Admin/InventoryManagement"><i class="fa fa-truck fa-lg fa-fw"></i><span>Manage Product</span></a>
                    </li>
                    <li class="sub-menu">
                        <a href="javascript:void(0);">
                            <i class="fa fa-line-chart fa-lg fa-fw"></i>
                            <span>Sales</span>
                            <i class="arrow fa fa-angle-right pull-right"></i>
                        </a>
                        <ul class="nav nav-second-level">
                            <li>
                                <!--<a href="~/Admin/Invoice">Invoices</a>-->
                                <a href="~/Admin/OrderManagement?ViewAll=true">Orders</a>
                            </li>
                        </ul>
                    </li>
                    <li class="sub-menu">
                        <a href="javascript:void(0);">
                            <i class="fa fa-book fa-lg fa-fw"></i>
                            <span>Logs</span>
                            <i class="arrow fa fa-angle-right pull-right"></i>
                        </a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="~/Admin/ActivityLog">View Activity Logs</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>

        </aside>
        <!--sidebar left end-->
        
        <!-- #page-wrapper -->
        <!--main content start-->
        <section class="main-content-wrapper">
            <section id="main-content">
                @RenderBody()
            </section>
        </section>
        <!-- /#page-wrapper -->

        <!--sidebar right start-->
        <aside class="sidebarRight">
            <div id="rightside-navigation ">
                <div class="sidebar-heading"><i class="fa fa-eye fa-fw"></i> Inventory Watcher</div>
                <div class="sidebar-title">critical level <i class="fa fa-exclamation"></i></div>
                <div class="list-contacts">

                @{
                    var db = Database.Open("tierone");

                    var getProducts = db.Query("SELECT * FROM Products");

                    foreach (var row in getProducts) {

                    /* Handles product stock alerts via side bar
                    *
                    * Function: Alerts the administrator whenever the available inventory/stock of 
                    *           specific product reached it's critical level.
                    *
                    * To Do: Make level of alert controllable by admin instead of pre-defined
                    */

                    /* Total of product inventory that is sold */
                    var soldInventory = @"SELECT SUM(Order_Details.Quantity) FROM Order_Details
                    INNER JOIN Orders
                    ON Orders.OrderId = Order_Details.OrderId
                    WHERE Order_Details.ProductId=@0
                    AND Orders.IsPaid=1";
                                                
                    /* Total of product inventory */
                    var currentInventory = @"SELECT SUM(Products_Inventory.Quantity) FROM Products_Inventory WHERE ProductId=@0";

                    var sold_inventory = db.QueryValue(soldInventory, @row.Id);
                    var current_inventory = db.QueryValue(currentInventory, @row.Id);
                    int total_inventory;

                    if (DBNull.Value.Equals(sold_inventory)) { sold_inventory = 0; }
                    if (DBNull.Value.Equals(current_inventory)) { current_inventory = 0; }
                    total_inventory = Convert.ToInt32(current_inventory) - Convert.ToInt32(sold_inventory);

                    /* Handles long product name and display it nicely without cutting the text */
                    string productName = row.Name;

                    if (productName.Length > 30) {
                        productName = productName.Substring(0, 30);
                        int index = productName.LastIndexOf(' ');
                        productName = productName.Substring(0, index) + "...";
                    }

                    if (total_inventory != 0 && total_inventory < 50) {
                    <a href="@Href("~/Admin/AddInventory", row.Id)" class="list-item">
                        <div class="list-item-image">  
                            @{var images = db.QuerySingle("SELECT FileTitle, FileExtension FROM Products_Image WHERE ForProductId=@0", row.Id);}
                            <img class="img-rounded"  src="~/Uploaded/@images.FileTitle@images.FileExtension" alt="@images.FileTitle + @images.FileExtension" />
                        </div>
                        <div class="list-item-content">
                            <h4>@productName</h4>
                            <p><strong class="text-warning">Stock: @total_inventory</strong></p>
                        </div>
                        <div class="item-status item-status-warning"></div>
                    </a>
                        }
                    }
                }

                </div>

                <div class="sidebar-title"><i class="fa fa-exclamation-triangle fa-fw"></i>&nbsp;out of stock</div>
                <div class="list-contacts">

                @{
                    foreach (var row in getProducts) {

                    /* Handles product stock alerts via side bar
                    *
                    * Function: Alerts the administrator whenever the available inventory/stock of 
                    *           specific product reached it's critical level.
                    *
                    * To Do: Make level of alert controllable by admin instead of pre-defined
                    */

                    /* Total of product inventory that is sold */
                    var soldInventory = @"SELECT SUM(Order_Details.Quantity) FROM Order_Details
                    INNER JOIN Orders
                    ON Orders.OrderId = Order_Details.OrderId
                    WHERE Order_Details.ProductId=@0
                    AND Orders.IsPaid=1";
                                                
                    /* Total of product inventory */
                    var currentInventory = @"SELECT SUM(Products_Inventory.Quantity) FROM Products_Inventory WHERE ProductId=@0";

                    var sold_inventory = db.QueryValue(soldInventory, @row.Id);
                    var current_inventory = db.QueryValue(currentInventory, @row.Id);
                    int total_inventory;

                    if (DBNull.Value.Equals(sold_inventory)) { sold_inventory = 0; }
                    if (DBNull.Value.Equals(current_inventory)) { current_inventory = 0; }
                    total_inventory = Convert.ToInt32(current_inventory) - Convert.ToInt32(sold_inventory);

                    /* Handles long product name and display it nicely without cutting the text */
                    string productName = row.Name;

                    if (productName.Length > 30) {
                        productName = productName.Substring(0, 30);
                        int index = productName.LastIndexOf(' ');
                        productName = productName.Substring(0, index) + "...";
                    }

                    if (total_inventory == 0) {
                    <a href="@Href("~/Admin/AddInventory", row.Id)" class="list-item">
                        <div class="list-item-image">  
                            @{var images = db.QuerySingle("SELECT FileTitle, FileExtension FROM Products_Image WHERE ForProductId=@0", row.Id);}
                            <img class="img-rounded"  src="~/Uploaded/@images.FileTitle@images.FileExtension" alt="@images.FileTitle + @images.FileExtension" />
                        </div>
                        <div class="list-item-content">
                            <h4>@productName</h4>
                            <p><strong class="text-danger">Stock: @total_inventory</strong></p>
                        </div>
                        <div class="item-status item-status-danger"></div>
                    </a>
                        }
                    }
                }

                </div>
            </div>
        </aside>
        <!--sidebar right end-->

        </section>
        <!-- /#wrapper -->

    </body>
</html>